<div id="calendar-page">
  <div class="calendar-header">
    <button id="prevMonth" class="calendar-nav">&lt;</button>
    <span id="calendarMonthYear"></span>
    <button id="nextMonth" class="calendar-nav">&gt;</button>
  </div>
  <table class="calendar-table">
    <thead>
      <tr>
        <th>일</th>
        <th>월</th>
        <th>화</th>
        <th>수</th>
        <th>목</th>
        <th>금</th>
        <th>토</th>
      </tr>
    </thead>
    <tbody id="calendarBody"></tbody>
  </table>
</div>
<!--투두리스트-->
<div id="todo-list-section">
  <h2>To-Do 리스트</h2>
  <div class="todo-input-area">
    <input type="text" id="todo-input" placeholder="할 일을 입력하세요" />
    <button id="add-todo-button">+</button>
  </div>
  <div id="todo-list">
    <!-- 할 일 목록이 여기에 추가 -->
  </div>
</div>

<link rel="stylesheet" href="/css/calendar.css" />

<!--calendar 자바스크립트-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    generateCalendar(new Date()); // 현재 날짜를 기준으로 캘린더 생성

    document.getElementById("prevMonth").addEventListener("click", function () {
      changeMonth(-1);
    });
    document.getElementById("nextMonth").addEventListener("click", function () {
      changeMonth(1);
    });
  });

  let currentDate = new Date();

  //캘린더 생성 함수
  function generateCalendar(date) {
    const monthYear = document.getElementById("calendarMonthYear");
    const calendarBody = document.getElementById("calendarBody");

    //현재 연도 및 월 표시
    monthYear.textContent = `${date.getFullYear()}년 ${date.getMonth() + 1}월`;

    //캘린더 내용 초기화
    calendarBody.innerHTML = "";

    //해당 월의 첫 번째 요일과 마지막 날짜 가져오기
    const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
    const lastDate = new Date(
      date.getFullYear(),
      date.getMonth() + 1,
      0
    ).getDate();

    let row = document.createElement("tr");

    for (let i = 0; i < firstDay; i++) {
      row.appendChild(document.createElement("td"));
    }

    for (let day = 1; day <= lastDate; day++) {
      if (row.children.length === 7) {
        calendarBody.appendChild(row);
        row = document.createElement("tr");
      }

      let cell = document.createElement("td"); //테이블 셀 생성
      cell.textContent = day; //날짜 표시
      cell.classList.add("calendar-day"); //CSS 스타일 추가

      const fullDate = `${date.getFullYear()}-${(date.getMonth() + 1)
        .toString()
        .padStart(2, "0")}-${day.toString().padStart(2, "0")}`;
      cell.setAttribute("data-date", fullDate);

      // 오늘 날짜 표시
      const today = new Date();
      if (
        date.getMonth() === today.getMonth() &&
        date.getFullYear() === today.getFullYear() &&
        day === today.getDate()
      ) {
        cell.classList.add("today");
      }

      // 클릭 시 날짜 정보 출력
      cell.addEventListener("click", function () {
        // 기존 선택된 날짜 스타일 초기화
        const prevSelected = document.querySelector(".selected");
        if (prevSelected) {
          prevSelected.classList.remove("selected");
        }

        cell.classList.add("selected");

        handleDateClick(fullDate);
      });

      row.appendChild(cell);
    }

    calendarBody.appendChild(row); // 마지막 `<tr>` 추가
  }

  //이전/다음 달 변경 함수
  function changeMonth(step) {
    currentDate.setMonth(currentDate.getMonth() + step);
    generateCalendar(currentDate);
  }

  function handleDateClick(date) {
    console.log("선택한 날짜:", date);
    alert(`선택한 날짜: ${date}`);
  }
</script>

<!--todo 리스트 자바스크립트-->
<script>
  // todo 리스트 관련 배열 데이터
  let todoList = [];

  // todo 리스트 초기화
  document.addEventListener("DOMContentLoaded", function () {
    const addTodoButton = document.getElementById("add-todo-button");
    const todoInput = document.getElementById("todo-input");

    //추가 버튼 클릭 이벤트
    addTodoButton.addEventListener("click", function () {
      addTodo(todoInput.value);
      todoInput.value = ""; //입력 필드 초기화
    });
  });

  //할 일 추가 함수
  function addTodo(content) {
    if (content.trim() === "") {
      alert("할 일을 입력하세요!");
      return;
    }

    //할 일 객체
    const todo = {
      id: Date.now(), //식별 id, 랜덤하게 설정하기 위해 date.now() 사용
      content: content, //내용
      isDone: false, //실행 여부
    };

    todoList.push(todo); //할 일 객체를 배열에 삽입
    renderTodoList();
  }

  // 할 일 리스트 렌더링 함수(화면 갱신)
  function renderTodoList() {
    const todoListElement = document.getElementById("todo-list");
    todoListElement.innerHTML = ""; // 기존 내용 초기화

    todoList.forEach((todo) => {
      const todoItem = document.createElement("div"); //화면에 표시될 div
      todoItem.className = `todo-item ${todo.isDone ? "done" : ""}`; //done이 되면 css에서 줄 그어지는 거 적용

      //버튼 요소에 이벤트 추가로 완료, 수정, 삭제 기능 구현
      todoItem.innerHTML = `
      <span class = "todo-text" id="todo-text-${
        todo.id
      }" onclick="toggleExpand(${todo.id})">${todo.content}</span>
      <div>
        <button onclick="toggleTodo(${todo.id})">
          <i class="fa-solid ${
            todo.isDone ? "fa-rotate-left" : "fa-check"
          }"></i>
        </button>
        <button onclick="editTodo(${todo.id})">
          <i class="fa-solid fa-pen"></i>
        </button>
        <button onclick="deleteTodo(${todo.id})">
          <i class="fa-solid fa-trash-can"></i>
        </button>
      </div>
    `;
      todoListElement.appendChild(todoItem);
    });
  }

  // 완료 상태 토글 함수
  function toggleTodo(id) {
    todoList = todoList.map((todo) =>
      todo.id === id ? { ...todo, isDone: !todo.isDone } : todo
    );
    renderTodoList(); //사용자가 클릭한 항목에서 id를 비교해서 배열에서 해당 항목을 찾고
    //체크 버튼을 누르냐, 로테이션 버튼을 누르냐에 따라 isDone 값이 바뀜
  }
  // 할 일 삭제 함수
  function deleteTodo(id) {
    todoList = todoList.filter((todo) => todo.id !== id);
    renderTodoList(); //마찬가지로 클릭한 항목에서 id를 비교해서 배열에서 해당 항목을 찾고 filter 함수로 새로운 배열 반환
  }

  // 할 일 수정 함수
  function editTodo(id) {
    const todoItem = todoList.find((todo) => todo.id === id);
    if (!todoItem) return;

    // 기존 span을 input으로 변경
    const todoTextElement = document.getElementById(`todo-text-${id}`);
    todoTextElement.outerHTML = `<input class = "input_style" type="text" id="edit-${id}" value="${todoItem.content}" 
    onkeypress="updateTodo(event, ${id})"/>`;

    // 자동 포커스
    setTimeout(() => {
      document.getElementById(`edit-${id}`).focus();
    }, 100);
  }

  //수정 내용 저장 함수
  function updateTodo(event, id) {
    if (event.key === "Enter") {
      //엔터 키 누르면 저장되도록
      const updatedContent = event.target.value;
      todoList = todoList.map((todo) =>
        todo.id === id ? { ...todo, content: updatedContent } : todo
      );
      renderTodoList();
    }
  }

  //긴 내용 자르기 함수
  function toggleExpand(id) {
    const todoText = document.getElementById(`todo-text-${id}`); // 특정 id를 가진 요소 찾기
    if (!todoText) return; // 요소가 없으면 함수 종료

    if (todoText.classList.contains("expanded")) {
      todoText.classList.remove("expanded"); // 축소
    } else {
      todoText.classList.add("expanded"); // 펼치기
    }
  }

  function initializeTodo() {
    const addTodoButton = document.getElementById("add-todo-button");
    const todoInput = document.getElementById("todo-input");

    addTodoButton.addEventListener("click", function () {
      addTodo(todoInput.value);
      todoInput.value = ""; // 입력 필드 초기화
    });

    renderTodoList(); // 초기 렌더링
  }
</script>
